<script>
    window._walkerSettings = {}
    window._walkerSettings.sendAsImage = false;
    window._walkerSettings.sendBase64 = false;
    window._walkerSettings.version = 1
    // enter your endpoint url here like https://ssgtm.example.com/elbwalker 
    window._walkerSettings.endpointUrl = "https://httpbin.org/anything";
    // add a path like https://ssgtm.example.com/walker.js or a locally stored
    // copy instead of using the CDN 
    window._walkerSettings.walkerpath = "https://cdn.jsdelivr.net/npm/@elbwalker/walker.js@1.5.3/dist/walker.js";
    window._walkerSettings.doAnalytics = true;
    
    // example configuration matching the simple example.html from the client template repository at
    // https://github.com/elbwalker/sgtm-client-template/tree/main/example  
    function getSessionData() {
      if (window._walkerSettings.doAnalytics !== true) return;
      var sts = window.sessionStorage.getItem("lg_sts");
      var sid = window.sessionStorage.getItem("lg_sid");
      var sct = window.localStorage.getItem("lg_sct") || 0;
      var cid = window.localStorage.getItem("lg_cid");
    
      var sStart = false;
    
      if (!sts) {
        //new session
        sStart = true;
        sts = Math.round(Date.now() / 1000);
        sid = Math.round(Math.random() * 10000000000);
        window.sessionStorage.setItem("lg_sts", sts);
        window.sessionStorage.setItem("lg_sid", sid);
        sct++;
        window.localStorage.setItem("lg_sct", sct);
      }
    
      if (!cid) {
        cid = sts+"."+sid;
        window.localStorage.setItem("lg_cid", cid);
      }
    
      return {
        sessionId: sid, 
        sessionNumber: sct, 
        sessionStartTimestamp: sts, 
        clientId: cid, 
        sessionStart: sStart
      };
    }
    
    function elb() {
      (window.elbLayer = window.elbLayer || []).push(arguments);
    }
    
    (function(w,a,l,k,e,r){
      w = window; 
      a = document.referrer;
      l = document.location.href;
      k = document.title;
      r = w._walkerSettings.endpointUrl;
    
      var wp = w._walkerSettings.walkerpath;
      if (wp) {
        var wsc = document.createElement("script");
        wsc.type = "text/javascript"; 
        wsc.className = "elbwalker"
        wsc.dataset.version = w._walkerSettings.version||"1"
        wsc.async = true; 
        wsc.defer = true; 
        wsc.src = wp; 
        document.head.appendChild(wsc);
      }
    
      //minimal bot detection, "stolen" from Trackboxx (https://cdn.trackboxx.info/p/tracker.js)
      if (/bot|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex/i.test(navigator.userAgent)) return false;
    
      var addGlobal = function(cnt){
        var sp = document.createElement("span");
        sp.dataset.elbglobals = cnt;
        document.body.appendChild(sp);
      };
      
      if ((w._walkerSettings.sendBase64 !== true) && 
          (w._walkerSettings.sendAsImage === true)) {
          l = l.split("#")[0];
      } 
      
      addGlobal("page_location:'"+l+"'");
      addGlobal("page_title:'"+k+"'");
      if (a) addGlobal("page_referrer:'"+a+"'");
    
      addGlobal("analytics_consent:'"+w._walkerSettings.doAnalytics+"'");
    
      //call session handling and set user attributes + elements for session id and number 
      var sD = getSessionData();
      if (sD) {
      elb("walker user", {hash: sD.sessionId, device: sD.clientId});
      addGlobal("session_started:'"+sD.sessionStartTimestamp+"'");
      addGlobal("session_number:'"+sD.sessionNumber+"'");
      if (sD.sessionStart === true)
          addGlobal("session_start:true");
      }
    
      elb("walker destination", { push: 
        function (event) {
          if (event.data && event.data.hash && 
          (w._walkerSettings.sendBase64 !== true) && 
          (w._walkerSettings.sendAsImage === true)) {
          event.data.hash = event.data.hash.replace("#", "");
          } 
          var obs = JSON.stringify(event);
          if (obs === "{}") 
          obs = ""; 
          else if (w._walkerSettings.sendBase64 === true) 
          obs = btoa(unescape(encodeURIComponent(obs)));
          var params = (obs !== "") ? "?o=" + encodeURI(obs) : "";
          if (w.XMLHttpRequest) e = new XMLHttpRequest();
          if ((e != null) && (w._walkerSettings.sendAsImage !== true)) {
            e.open("POST", r, true);
            e.setRequestHeader("Content-Type", "text/plain");
            e.send(obs);
          } else  
            (new Image()).src = r + params;
          console.log(event);
        }
      }); 
      elb("walker run");
    })();
    </script>